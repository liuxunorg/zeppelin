{#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
-#}
<div id="job-manager-header">
  <div class="header">
    <div class="row" style="width:100%">
      <div class="col-md-12">
        <h3 class="new_h3">
          Submarine Dashboard
        </h3>
      </div>
    </div>
    <div class="row" style="width:100%">
      <div class="col-md-12">
        You can execute the selected command by entering the parameters in the interface below.
        <button class="btn btn-default btn-xs" style="margin-left:10px;"
          ng-click="z.angularBind('COMMAND_TYPE','USAGE','{{ PARAGRAPH_ID }}');z.runParagraph('{{ PARAGRAPH_ID }}');"
          tooltip-placement="top" uib-tooltip="Show submarine usage & Parameter Description"> <span class="fa fa-info-circle"></span> Usage</button>
        <button class="btn btn-default btn-xs" style="margin-left:2px;"
          ng-click="z.angularBind('COMMAND_TYPE','CLEAN_RUNTIME_CACHE','{{ PARAGRAPH_ID }}');z.runParagraph('{{ PARAGRAPH_ID }}');"
          tooltip-placement="top" uib-tooltip="Clean submarine runtime cache"> <span class="fa fa-trash"></span> Clean</button>
      </div>
    </div>
  </div>

  <hr style="margin-top: 10px; margin-bottom: 10px;"/>

  <div class="row" style="width:100%; margin-top:20px;">
    <div class="job-search-tool">
      <div class="form-inline">
        <span class="btn-group">
          <label style="width:150px;text-align:right;margin-right:4px;">Command: </label>
          <select ng-model="submarineCommand" style="width:200px;margin-right:10px" class="form-control"
                ng-change="COMMAND_TYPE=submarineCommand">
            <option value="" ng-selected="'{%raw%}{{COMMAND_TYPE}}{%endraw%}'==''">-- Please select --</option>
            <option value="JOB_RUN" ng-selected="'{%raw%}{{COMMAND_TYPE}}{%endraw%}'=='JOB_RUN'">JOB RUN</option>
            <option value="JOB_SHOW" ng-selected="'{%raw%}{{COMMAND_TYPE}}{%endraw%}'=='JOB_SHOW'">JOB SHOW</option>
            <option value="JOB_CANCEL" ng-selected="'{%raw%}{{COMMAND_TYPE}}{%endraw%}'=='JOB_CANCEL'">JOB CANCEL</option>
            <option value="OLD_UI" ng-selected="'{%raw%}{{COMMAND_TYPE}}{%endraw%}'=='OLD_UI'">OLD UI</option>
            <option value="USAGE" ng-selected="'{%raw%}{{COMMAND_TYPE}}{%endraw%}'=='USAGE'">USAGE</option>
          </select>
        </span>
        <button type="submit" class="btn btn-primary"
          ng-click="z.angularBind('COMMAND_TYPE',COMMAND_TYPE,'{{ PARAGRAPH_ID }}');z.runParagraph('{{ PARAGRAPH_ID }}')">
          Run Command
        </button>
      </div>
    </div>
  </div>
</div>

<div ng-if="COMMAND_TYPE=='JOB_RUN'">
  <form class="form-inline" style="margin-top: 10px;">
    <div class="form-group">
      <label style="width:150px;text-align:right;margin-right:4px;">Data Path: </label>
      <input type="text" style="width:800px" class="form-control" id="inputPath"
        placeholder="Please input data path ( eg. hdfs://cluster1/... )" ng-value="INPUT_PATH"
        ng-change="z.angularBind('INPUT_PATH',inputPath,'{{ PARAGRAPH_ID }}')" ng-model="inputPath"></input>
    </div>
  </form>

  <form class="form-inline" style="margin-top: 10px;">
    <div class="form-group">
      <label style="width:150px;text-align:right;margin-right:4px;">Checkpoint Path: </label>
      <input type="text" style="width:800px" class="form-control" id="checkpointPath"
      placeholder="Please input checkpoint data path ( eg. hdfs://cluster1/... )" ng-value="CHECKPOINT_PATH"
      ng-change="z.angularBind('CHECKPOINT_PATH',checkpointPath,'{{ PARAGRAPH_ID }}')" ng-model="checkpointPath"></input>
    </div>
  </form>

  <form class="form-inline" style="margin-top: 10px;">
    <div class="form-group">
      <label style="width:150px;text-align:right;margin-right:4px;">PS Launch Cmd: </label>
      <input type="text" style="width:800px" class="form-control" id="psLaunchCmd"
        placeholder="Please input PS launch command (eg. python cifar10_main.py --data-dir=%input_path% --job-dir=%checkpoint_path% --num-gpus=0 ...)"
        ng-value="PS_LAUNCH_CMD" ng-change="z.angularBind('PS_LAUNCH_CMD',psLaunchCmd,'{{ PARAGRAPH_ID }}')"
        ng-model="psLaunchCmd"></input>
    </div>
  </form>

  <form class="form-inline" style="margin-top: 10px;">
    <div class="form-group">
      <label style="width:150px;text-align:right;margin-right:4px;">Worker Launch Cmd: </label>
      <input type="text" style="width:800px" class="form-control" id="workerLaunchCmd"
        placeholder="Please input Work launch command (eg. python cifar10_main.py --data-dir=%input_path% --job-dir=%checkpoint_path% --num-gpus=1 ...)"
        ng-value="WORKER_LAUNCH_CMD" ng-change="z.angularBind('WORKER_LAUNCH_CMD',workerLaunchCmd,'{{ PARAGRAPH_ID }}')"
        ng-model="workerLaunchCmd"></input>
    </div>
  </form>
</div>

<div class="job" style="margin-top:10px; margin-bottom:10px;" ng-if="JOB_STATUS!=undefined && JOB_STATUS!='READY'">
  <div>
    <label style="width:140px;text-align:right;margin-right:4px;">Submarine Runtime: </label>

    <i ng-if="JOB_STATUS=='ACCEPT' || JOB_STATUS=='YARN NEW' || JOB_STATUS=='YARN NEW SAVING' || JOB_STATUS=='YARN_ACCEPTED'"
      ng-style="{'color':'green'}" tooltip-placement="top" uib-tooltip="{%raw%}{{YARN_APPLICATION_ID}}{%endraw%} is Accept" class="fa fa-circle-o"">  {%raw%}{{JOB_STATUS}}{%endraw%}</i>
    <i ng-if="JOB_STATUS=='EXECUTE SUBMARINE' || JOB_STATUS=='YARN_SUBMITTED' || JOB_STATUS=='YARN RUNNING'"
      ng-style="{'color':'green'}" tooltip-placement="top" uib-tooltip="{%raw%}{{YARN_APPLICATION_ID}}{%endraw%} is Running" class="fa fa-spinner"">  {%raw%}{{JOB_STATUS}}{%endraw%}</i>
    <i ng-if="JOB_STATUS=='EXECUTE SUBMARINE FINISHED' || JOB_STATUS=='YARN_FINISHED'"
      ng-style="{'color':'green'}" tooltip-placement="top" uib-tooltip="{%raw%}{{YARN_APPLICATION_ID}}{%endraw%} is Finished" class="fa fa-circle"">  {%raw%}{{JOB_STATUS}}{%endraw%}</i>
    <i ng-if="JOB_STATUS=='EXECUTE SUBMARINE ERROR' || JOB_STATUS=='YARN_FAILED' || JOB_STATUS=='YARN_KILLED'"
      ng-style="{'color':'red'}" tooltip-placement="top" uib-tooltip="{%raw%}{{YARN_APPLICATION_ID}}{%endraw%} is Failed" class="fa fa-circle"">  {%raw%}{{JOB_STATUS}}{%endraw%}</i>

    <span ng-if="YARN_APP_EXECUTE_TIME!=undefined" class="ng-binding ng-scope" style="background: rgba(255,255,255,0.85); color: #999; font-size:12px; margin-left: 10px;">{%raw%}{{YARN_APP_EXECUTE_TIME}}{%endraw%}</span>
    <!--span ng-if="YARN_APPLICATION_ID!=undefined" class="ng-binding ng-scope" style="background: rgba(255,255,255,0.85); color: #999; font-size:12px; margin-left: 10px;">{%raw%}{{JOB_PROGRESS}}%{%endraw%}</span-->

    <a ng-if="YARN_APPLICATION_URL!=undefined" style="text-decoration: none !important;text-decoration:underline; cursor:pointer;margin-left: 10px;" ng-href="{%raw%}{{YARN_APPLICATION_URL}}{%endraw%}" target="_blank" tooltip-placement="top" uib-tooltip="click view application in YARN">
      <span class="fa fa-external-link-square" ></span> YARN {%raw%}{{YARN_APPLICATION_ID}}{%endraw%}
    </a>

    <a ng-if="YARN_APP_TENSORFLOW_URL!=undefined" style="text-decoration: none !important;text-decoration:underline; cursor:pointer;margin-left: 10px;" ng-href="{%raw%}{{YARN_APP_TENSORFLOW_URL}}{%endraw%}" target="_blank" tooltip-placement="top" uib-tooltip="click view training in TENSORBOARD">
      <span class="fa fa-external-link-square" style="font-size:12px;"></span> Tensorboard
    </a>

    <!-- job progress bar: start -->
    <div id="submarineRunControl" class="runControl" ng-if="JOB_STATUS=='ACCEPT' || JOB_STATUS=='YARN NEW' || JOB_STATUS=='YARN NEW SAVING' || JOB_STATUS=='YARN_ACCEPTED' || JOB_STATUS=='EXECUTE SUBMARINE' || JOB_STATUS=='YARN_SUBMITTED' || JOB_STATUS=='YARN RUNNING'">
      <div id="submarineProgress" class="progress ng-scope"">
        <div class="progress-bar progress-bar-striped active" role="progressbar" style="width: {%raw%}{{JOB_PROGRESS}}%{%endraw%};"/>
      </div>
    </div>
    <!-- job progress bar: end -->
  </div>
</div>
